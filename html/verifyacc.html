<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="../assets/" data-template="vertical-menu-template-free">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Account Locked</title>
  <meta name="description" content="Suspicious login activity detected." />

  <link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="../assets/vendor/css/core.css" />
  <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" />
  <link rel="stylesheet" href="../assets/css/demo.css" />
  <link rel="stylesheet" href="../assets/vendor/css/pages/page-misc.css" />

  <script src="../assets/vendor/js/helpers.js"></script>
  <script src="../assets/js/config.js"></script>
</head>

<body>
  <div class="container-xxl container-p-y">
  <div class="misc-wrapper text-center">
    
   <h2 class="mb-2" style="font-weight: 600; color: #ab0808;">Account Locked</h2>
    <p class="mb-4" style="font-size: 1.05rem; color: #555; line-height: 1.7;">
    We've detected suspicious activity on your account.<br />
    For your protection, access has been temporarily disabled.<br />
    A verification link has been sent to your email address.<br />
    Please check your inbox to restore access.
    </p>



      <form id="verifyForm">
        <input type="hidden" name="email" id="emailInput" />
        <a href="..\html\Login.html" class="btn btn-warning">Refresh</a>

      </form>

      <div class="mt-4">
        <img src="../assets/img/illustrations/page-misc-error-light.png" alt="Account Locked" width="550" class="img-fluid" />
      </div>
    </div>
  </div>

  <script src="../assets/vendor/libs/jquery/jquery.js"></script>
  <script src="../assets/vendor/js/bootstrap.js"></script>
  <script src="../assets/vendor/js/menu.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const emailInput = document.getElementById("emailInput");
      const form = document.getElementById("verifyForm");

      // Ambil email dari sessionStorage
      const userEmail = sessionStorage.getItem("user_email");
      if (userEmail) {
        emailInput.value = userEmail;
      } else {
        // Jika email tidak ditemukan, tampilkan alert dan redirect ke halaman login
        Swal.fire({
          icon: "error",
          title: "Error",
          text: "Email not found in session. Please login again.",
        }).then(() => {
          window.location.href = "login.html";
        });
        return;
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Tampilkan SweetAlert loading sebelum request
        Swal.fire({
          title: 'Sending Email...',
          text: 'Please wait, we are sending a verification email to your inbox.',
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });

        const formData = new FormData();
        formData.append("email", userEmail);

        try {
          const response = await fetch("http://localhost:8000/login/send-unlock-verification", {
            method: "POST",
            body: formData,
          });

          // Tutup pop-up loading
          Swal.close();

          if (!response.ok) {
            const data = await response.json();
            throw new Error(data.detail || "Failed to send verification email.");
          }
          
          // Tampilkan pop-up sukses dan arahkan ke login.html setelah OK
          Swal.fire({
            icon: "success",
            title: "Verification Sent",
            text: "A verification email has been sent. Please check your inbox.",
            confirmButtonColor: "#3085d6"
          }).then(() => {
            window.location.href = "login.html";
          });

        } catch (error) {
          // Tutup pop-up loading jika ada error, lalu tampilkan error
          Swal.close();
          Swal.fire("Error", error.message, "error");
        }
      });
    });
  </script>
</body>
</html>